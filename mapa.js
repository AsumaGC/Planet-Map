// ==UserScript==
// @name         Imperio Brasil Planet!
// @namespace    Discord.io/Brasil-Place
// @version      1.0.0
// @description  Minimapa criado para a facção Imperio Brasil Planet
// @coder        sʀᴏʙsɪᴅɪᴀɴ#7569
// @Edited       Aѕυмα#0785
// @match        https://pixelplanet.fun/*
// @match        http://pixelplanet.fun/*
// @homepage     Discord.io/Brasil-Place
// @updateURL    http://raw.githubusercontent.com/AsumaGC/Planet-Map/master/mapa.js
// @downloadURL  http://raw.githubusercontent.com/AsumaGC/Planet-Map/master/mapa.js
// ==/UserScript==

var _0x334a=['Mostrar\x20mapa','cursor','pointer','onclick','default','zoom-plus','mousedown','preventDefault','mouseup','zoom-minus','mousemove','coorbox','split','substring','Updating\x20Template\x20List','readyState','status','parse','responseText','open','send','log','minimap-box','minimapbg','Show\x20Minimap','push','length','between','\x20\x20\x20\x20Load\x20image\x20','images/','name','onload','clearRect','drawImage','.png\x20[Pos:','beginPath','moveTo','lineTo','strokeStyle','lineWidth','red','stroke','href','replace','*[style]','coords','createElement','innerHTML','.palettebox\x20{text-align:\x20center;vertical-align:\x20middle;line-height:\x200;padding:\x203px;position:\x20absolute;right:\x2050%;height:\x2018em;width:\x203em;top:\x2072%;\x20transform:\x20rotate(90deg);margin-left:\x20auto;margin-right:\x20auto;display:\x20flex;flex-wrap:\x20wrap-reverse;}','body','appendChild','prototype','min','apply','max','baseTepmlateUrl','addEventListener','getElementById','gameWindow','setAttribute','class','<div\x20id=\x22minimapbg\x22\x20style=\x22-webkit-user-drag:\x20none;-khtml-user-drag:\x20none;-moz-user-drag:\x20none;-o-user-drag:\x20none;user-drag:\x20none;position:\x20absolute;\x20right:\x201em;\x20bottom:\x201em;z-index:\x2099999;\x22>','<div\x20class=\x22posy\x22\x20id=\x22posyt\x22\x20style=\x22-webkit-user-drag:\x20none;-khtml-user-drag:\x20none;-moz-user-drag:\x20none;-o-user-drag:\x20none;user-drag:\x20none;background-size:\x20100%;\x20background-color:\x20#313131;\x20background-image:\x20url(https://media.discordapp.net/attachments/527294050668380170/565725155821617162/tempBackground.png?width=300&height=300);\x20color:\x20rgb(250,\x20250,\x20250);\x20text-align:\x20center;\x20line-height:\x2042px;\x20vertical-align:\x20middle;\x20width:\x20auto;\x20height:\x20auto;\x20border-radius:\x2021px;\x20padding:\x206px;\x22>','<div\x20id=\x22minimap-text\x22\x20style=\x22-webkit-user-drag:\x20none;-khtml-user-drag:\x20none;-moz-user-drag:\x20none;-o-user-drag:\x20none;user-drag:\x20none;display:\x20none;\x22></div>','<div\x20id=\x22minimap-box\x22\x20style=\x22-webkit-user-drag:\x20none;-khtml-user-drag:\x20none;-moz-user-drag:\x20none;-o-user-drag:\x20none;user-drag:\x20none;position:\x20relative;width:420px;height:300px\x22>','<canvas\x20id=\x22minimap-board\x22\x20style=\x22-webkit-user-drag:\x20none;-khtml-user-drag:\x20none;-moz-user-drag:\x20none;-o-user-drag:\x20none;user-drag:\x20none;width:\x20100%;\x20height:\x20100%;z-index:2;position:absolute;top:0;left:0;\x22></canvas>','</div><div\x20id=\x22minimap-config\x22\x20style=\x22-webkit-user-drag:\x20none;-khtml-user-drag:\x20none;-moz-user-drag:\x20none;-o-user-drag:\x20none;user-drag:\x20none;line-height:20px;\x22>','</span>\x20|\x20<span\x20id=\x22follow-mouse\x22\x20style=\x22-webkit-user-drag:\x20none;-khtml-user-drag:\x20none;-moz-user-drag:\x20none;-o-user-drag:\x20none;user-drag:\x20none;cursor:pointer;\x22Seguir\x20Mouse','</span>\x20|\x20Zoom:\x20<span\x20id=\x22zoom-plus\x22\x20style=\x22-webkit-user-drag:\x20none;-khtml-user-drag:\x20none;-moz-user-drag:\x20none;-o-user-drag:\x20none;user-drag:\x20none;cursor:pointer;font-weight:bold;\x22>+</span>\x20\x20/\x20\x20','<span\x20id=\x22zoom-minus\x22\x20style=\x22-webkit-user-drag:\x20none;-khtml-user-drag:\x20none;-moz-user-drag:\x20none;-o-user-drag:\x20none;user-drag:\x20none;cursor:pointer;font-weight:bold;\x22>-</span>','</div>','minimap','floor','width','minimap-board','minimap-cursor','offsetWidth','height','offsetHeight','getContext','mozImageSmoothingEnabled','webkitImageSmoothingEnabled','msImageSmoothingEnabled','imageSmoothingEnabled','hide-map','style','minimap-config','display','none','minimap-text','block'];(function(_0xb479be,_0x4bb6ab){var _0x44c2ed=function(_0x39774b){while(--_0x39774b){_0xb479be['push'](_0xb479be['shift']());}};_0x44c2ed(++_0x4bb6ab);}(_0x334a,0x89));var _0x58f7=function(_0x5f21c8,_0x1da67a){_0x5f21c8=_0x5f21c8-0x0;var _0x12237c=_0x334a[_0x5f21c8];return _0x12237c;};var stle=document[_0x58f7('0x0')]('style');stle[_0x58f7('0x1')]=_0x58f7('0x2');document[_0x58f7('0x3')][_0x58f7('0x4')](stle);Number[_0x58f7('0x5')]['between']=function(_0x449a3f,_0x2b4ce7){var _0xa074bb=Math[_0x58f7('0x6')][_0x58f7('0x7')](Math,[_0x449a3f,_0x2b4ce7]),_0x248ed2=Math[_0x58f7('0x8')][_0x58f7('0x7')](Math,[_0x449a3f,_0x2b4ce7]);return this>_0xa074bb&&this<_0x248ed2;};var rangeValue=0xdc;window[_0x58f7('0x9')]='https://raw.githubusercontent.com/AsumaGC/Planet-Map/master/';window[_0x58f7('0xa')]('load',function(){re=/(.*)\/\?p=(\-?(?:\d*)),(\-?(?:\d*))/g;rec=/x\:(\d*) y\:(\d*)/g;gameWindow=document[_0x58f7('0xb')](_0x58f7('0xc'));coorDOM=null;findCoor();x_window=0x0;y_window=0x0;x=0x0;y=0x0;template_list=null;zoomlevel=0x9;toggle_show=!![];toggle_follow=!![];zooming_in=![];zooming_out=![];zoom_time=0x64;image_list=[];counter=0x0;needed_templates=null;cachebreaker=null;var _0x213730=document[_0x58f7('0x0')]('div');_0x213730[_0x58f7('0xd')](_0x58f7('0xe'),'post\x20block\x20bc2');_0x213730[_0x58f7('0x1')]=_0x58f7('0xf')+_0x58f7('0x10')+_0x58f7('0x11')+_0x58f7('0x12')+'<canvas\x20id=\x22minimap\x22\x20style=\x22-webkit-user-drag:\x20none;-khtml-user-drag:\x20none;-moz-user-drag:\x20none;-o-user-drag:\x20none;user-drag:\x20none;width:\x20100%;\x20height:\x20100%;z-index:1;position:absolute;top:0;left:0;\x22></canvas>'+_0x58f7('0x13')+'<canvas\x20id=\x22minimap-cursor\x22\x20style=\x22-webkit-user-drag:\x20none;-khtml-user-drag:\x20none;-moz-user-drag:\x20none;-o-user-drag:\x20none;user-drag:\x20none;width:\x20100%;\x20height:\x20100%;z-index:3;position:absolute;top:0;left:0;\x22></canvas>'+_0x58f7('0x14')+'<span\x20id=\x22hide-map\x22\x20style=\x22-webkit-user-drag:\x20none;-khtml-user-drag:\x20none;-moz-user-drag:\x20none;-o-user-drag:\x20none;user-drag:\x20none;cursor:pointer;\x22>Ocultar\x20mapa'+_0x58f7('0x15')+_0x58f7('0x16')+_0x58f7('0x17')+_0x58f7('0x18')+_0x58f7('0x18');document[_0x58f7('0x3')][_0x58f7('0x4')](_0x213730);minimap=document[_0x58f7('0xb')](_0x58f7('0x19'));range=Math[_0x58f7('0x1a')](minimap[_0x58f7('0x1b')]/0x2*(0x1/zoomlevel)-0x1);minimap_board=document[_0x58f7('0xb')](_0x58f7('0x1c'));minimap_cursor=document['getElementById'](_0x58f7('0x1d'));minimap[_0x58f7('0x1b')]=minimap[_0x58f7('0x1e')];minimap_board[_0x58f7('0x1b')]=minimap_board['offsetWidth'];minimap_cursor[_0x58f7('0x1b')]=minimap_cursor[_0x58f7('0x1e')];minimap[_0x58f7('0x1f')]=minimap['offsetHeight'];minimap_board['height']=minimap_board[_0x58f7('0x20')];minimap_cursor[_0x58f7('0x1f')]=minimap_cursor[_0x58f7('0x20')];ctx_minimap=minimap[_0x58f7('0x21')]('2d');ctx_minimap_board=minimap_board['getContext']('2d');ctx_minimap_cursor=minimap_cursor[_0x58f7('0x21')]('2d');ctx_minimap[_0x58f7('0x22')]=![];ctx_minimap[_0x58f7('0x23')]=![];ctx_minimap[_0x58f7('0x24')]=![];ctx_minimap[_0x58f7('0x25')]=![];drawBoard();drawCursor();document[_0x58f7('0xb')](_0x58f7('0x26'))['onclick']=function(){toggle_show=![];document[_0x58f7('0xb')]('minimap-box')[_0x58f7('0x27')]['display']='none';document[_0x58f7('0xb')](_0x58f7('0x28'))[_0x58f7('0x27')][_0x58f7('0x29')]=_0x58f7('0x2a');document[_0x58f7('0xb')](_0x58f7('0x2b'))[_0x58f7('0x27')]['display']=_0x58f7('0x2c');document[_0x58f7('0xb')](_0x58f7('0x2b'))[_0x58f7('0x1')]=_0x58f7('0x2d');document[_0x58f7('0xb')](_0x58f7('0x2b'))[_0x58f7('0x27')][_0x58f7('0x2e')]=_0x58f7('0x2f');};document[_0x58f7('0xb')](_0x58f7('0x2b'))[_0x58f7('0x30')]=function(){toggle_show=!![];document['getElementById']('minimap-box')[_0x58f7('0x27')][_0x58f7('0x29')]=_0x58f7('0x2c');document[_0x58f7('0xb')](_0x58f7('0x28'))[_0x58f7('0x27')][_0x58f7('0x29')]=_0x58f7('0x2c');document['getElementById']('minimap-text')[_0x58f7('0x27')][_0x58f7('0x29')]='none';document[_0x58f7('0xb')](_0x58f7('0x2b'))[_0x58f7('0x27')][_0x58f7('0x2e')]=_0x58f7('0x31');loadTemplates();};document[_0x58f7('0xb')](_0x58f7('0x32'))[_0x58f7('0xa')](_0x58f7('0x33'),function(_0x210e55){_0x210e55[_0x58f7('0x34')]();zooming_in=!![];zooming_out=![];zoomIn();},![]);document['getElementById']('zoom-minus')[_0x58f7('0xa')](_0x58f7('0x33'),function(_0x3d57dc){_0x3d57dc[_0x58f7('0x34')]();zooming_out=!![];zooming_in=![];zoomOut();},![]);document[_0x58f7('0xb')]('zoom-plus')[_0x58f7('0xa')](_0x58f7('0x35'),function(_0x32d343){zooming_in=![];},![]);document[_0x58f7('0xb')](_0x58f7('0x36'))[_0x58f7('0xa')](_0x58f7('0x35'),function(_0x4c67eb){zooming_out=![];},![]);gameWindow=document[_0x58f7('0xb')](_0x58f7('0xc'));gameWindow[_0x58f7('0xa')]('mouseup',function(_0x5783b6){if(!toggle_show)return;if(!toggle_follow)setTimeout(getCenter,0x64);},![]);gameWindow[_0x58f7('0xa')](_0x58f7('0x37'),function(_0x1319d6){if(!toggle_show)return;coorDOM=document['getElementsByClassName'](_0x58f7('0x38'))[0x0]['innerHTML'];coordsXY=coorDOM[_0x58f7('0x39')](/(\d+)/);x_new=(coordsXY[0x0][_0x58f7('0x3a')](0x1)+coordsXY[0x1])*0x1;y_new=(coordsXY[0x2][_0x58f7('0x3a')](0x1)+coordsXY[0x3])*0x1;if(x!=x_new||y!=y_new){x=parseInt(x_new);y=parseInt(y_new);if(toggle_follow){x_window=x;y_window=y;}else{drawCursor();}loadTemplates();}},![]);updateloop();},![]);function updateloop(){console['log'](_0x58f7('0x3b'));var _0x4991b4=new XMLHttpRequest();var _0x3706e3=window[_0x58f7('0x9')]+'templates/data.json?'+new Date()['getTime']();_0x4991b4['onreadystatechange']=function(){if(this[_0x58f7('0x3c')]==0x4&&this[_0x58f7('0x3d')]==0xc8){template_list=JSON[_0x58f7('0x3e')](this[_0x58f7('0x3f')]);if(!toggle_follow)getCenter();}};_0x4991b4[_0x58f7('0x40')]('GET',_0x3706e3,!![]);_0x4991b4[_0x58f7('0x41')]();console[_0x58f7('0x42')]('Refresh\x20got\x20forced.');image_list=[];loadTemplates();setTimeout(updateloop,0xea60);}function toggleShow(){toggle_show=!toggle_show;if(toggle_show){document[_0x58f7('0xb')](_0x58f7('0x43'))[_0x58f7('0x27')][_0x58f7('0x29')]=_0x58f7('0x2c');document[_0x58f7('0xb')](_0x58f7('0x28'))[_0x58f7('0x27')][_0x58f7('0x29')]=_0x58f7('0x2c');document[_0x58f7('0xb')]('minimap-text')[_0x58f7('0x27')]['display']='none';document[_0x58f7('0xb')](_0x58f7('0x44'))[_0x58f7('0x30')]=function(){};loadTemplates();}else{document[_0x58f7('0xb')]('minimap-box')[_0x58f7('0x27')][_0x58f7('0x29')]='none';document[_0x58f7('0xb')](_0x58f7('0x28'))[_0x58f7('0x27')][_0x58f7('0x29')]='none';document[_0x58f7('0xb')](_0x58f7('0x2b'))[_0x58f7('0x27')][_0x58f7('0x29')]='block';document[_0x58f7('0xb')](_0x58f7('0x2b'))[_0x58f7('0x1')]=_0x58f7('0x45');document[_0x58f7('0xb')](_0x58f7('0x44'))[_0x58f7('0x30')]=function(){toggleShow();};}}function zoomIn(){if(!zooming_in)return;zoomlevel=zoomlevel*1.1;range=Math[_0x58f7('0x1a')](minimap['width']/0x2*(0x1/zoomlevel)-0x1);if(zoomlevel>0x2d){zoomlevel=0x2d;return;}drawBoard();drawCursor();loadTemplates();setTimeout(zoomIn,zoom_time);}function zoomOut(){if(!zooming_out)return;zoomlevel=zoomlevel/1.1;range=Math[_0x58f7('0x1a')](minimap[_0x58f7('0x1b')]/0x2*(0x1/zoomlevel)-0x1);if(zoomlevel<0x1){zoomlevel=0x1;return;}drawBoard();drawCursor();loadTemplates();setTimeout(zoomOut,zoom_time);}function loadTemplates(){if(!toggle_show)return;if(template_list==null)return;var _0x1c8c02=x_window*0x1-minimap[_0x58f7('0x1b')]/zoomlevel/0x2;var _0x2eb1d3=x_window*0x1+minimap[_0x58f7('0x1b')]/zoomlevel/0x2;var _0x34d283=y_window*0x1-minimap[_0x58f7('0x1f')]/zoomlevel/0x2;var _0x9c269a=y_window*0x1+minimap[_0x58f7('0x1f')]/zoomlevel/0x2;var _0x32b758=[];for(var _0x242231 in template_list)_0x32b758[_0x58f7('0x46')](_0x242231);needed_templates=[];var _0x22a373;for(_0x22a373=0x0;_0x22a373<_0x32b758[_0x58f7('0x47')];_0x22a373++){template=_0x32b758[_0x22a373];var _0x95c945=parseInt(template_list[template]['x'])*0x1;var _0x2a136d=parseInt(template_list[template]['y'])*0x1;var _0x5af1fa=parseInt(template_list[template]['x'])+parseInt(template_list[template][_0x58f7('0x1b')]);var _0x65dc47=parseInt(template_list[template]['y'])+parseInt(template_list[template][_0x58f7('0x1f')]);if(!x_window[_0x58f7('0x48')](_0x95c945-range*0x1,_0x5af1fa+range*0x1))continue;if(!y_window['between'](_0x2a136d-range*0x1,_0x65dc47+range*0x1))continue;needed_templates[_0x58f7('0x46')](template);}if(needed_templates['length']==0x0){if(zooming_in==![]&&zooming_out==![]){document[_0x58f7('0xb')](_0x58f7('0x43'))[_0x58f7('0x27')][_0x58f7('0x29')]=_0x58f7('0x2a');document[_0x58f7('0xb')](_0x58f7('0x2b'))[_0x58f7('0x27')][_0x58f7('0x29')]='block';document[_0x58f7('0xb')](_0x58f7('0x2b'))[_0x58f7('0x1')]='|\x20\x20Nada\x20aqui\x20\x20|';}}else{document[_0x58f7('0xb')](_0x58f7('0x43'))[_0x58f7('0x27')][_0x58f7('0x29')]='block';document[_0x58f7('0xb')](_0x58f7('0x2b'))[_0x58f7('0x27')][_0x58f7('0x29')]=_0x58f7('0x2a');counter=0x0;for(_0x22a373=0x0;_0x22a373<needed_templates[_0x58f7('0x47')];_0x22a373++){if(image_list[needed_templates[_0x22a373]]==null){loadImage(needed_templates[_0x22a373]);}else{counter+=0x1;if(counter==needed_templates[_0x58f7('0x47')])drawTemplates();}}}}function loadImage(_0x67367c){console['log'](_0x58f7('0x49')+_0x67367c);image_list[_0x67367c]=new Image();if(cachebreaker!=null)image_list[_0x67367c]['src']=window[_0x58f7('0x9')]+_0x58f7('0x4a')+template_list[_0x67367c][_0x58f7('0x4b')];else image_list[_0x67367c]['src']=window[_0x58f7('0x9')]+_0x58f7('0x4a')+template_list[_0x67367c][_0x58f7('0x4b')];image_list[_0x67367c][_0x58f7('0x4c')]=function(){counter+=0x1;if(counter==needed_templates[_0x58f7('0x47')])drawTemplates();};}function drawTemplates(){ctx_minimap[_0x58f7('0x4d')](0x0,0x0,minimap['width'],minimap[_0x58f7('0x1f')]);var _0x1a7561=x_window*0x1-minimap[_0x58f7('0x1b')]/zoomlevel/0x2;var _0x43dc9a=y_window*0x1-minimap[_0x58f7('0x1f')]/zoomlevel/0x2;var _0x34d919;for(_0x34d919=0x0;_0x34d919<needed_templates[_0x58f7('0x47')];_0x34d919++){var _0x52057e=needed_templates[_0x34d919];var _0x3810bb=(template_list[_0x52057e]['x']*0x1-_0x1a7561*0x1)*zoomlevel;var _0x422d1c=(template_list[_0x52057e]['y']*0x1-_0x43dc9a*0x1)*zoomlevel;var _0x3d07fb=zoomlevel*image_list[_0x52057e][_0x58f7('0x1b')];var _0x2b1809=zoomlevel*image_list[_0x52057e][_0x58f7('0x1f')];var _0x4f6029=image_list[_0x52057e];ctx_minimap[_0x58f7('0x4e')](_0x4f6029,_0x3810bb,_0x422d1c,_0x3d07fb,_0x2b1809);console['log'](_0x52057e+_0x58f7('0x4f'),template_list[_0x52057e]['x'],template_list[_0x52057e]['y']+']');}}function drawBoard(){ctx_minimap_board[_0x58f7('0x4d')](0x0,0x0,minimap_board[_0x58f7('0x1b')],minimap_board[_0x58f7('0x1f')]);if(zoomlevel<=4.6)return;ctx_minimap_board[_0x58f7('0x50')]();var _0x549cfd=minimap_board[_0x58f7('0x1b')]+zoomlevel;var _0x17c428=minimap_board[_0x58f7('0x1f')]+zoomlevel;var _0x41e47e=minimap[_0x58f7('0x1b')]/0x2%zoomlevel-zoomlevel;var _0x2e982a=minimap[_0x58f7('0x1f')]/0x2%zoomlevel-zoomlevel;var _0x4e6f40=0x1*zoomlevel;for(var _0x1d6505=0x0;_0x1d6505<=_0x549cfd;_0x1d6505+=_0x4e6f40){ctx_minimap_board[_0x58f7('0x51')](_0x1d6505+_0x41e47e,_0x2e982a);ctx_minimap_board[_0x58f7('0x52')](_0x1d6505+_0x41e47e,_0x17c428+_0x2e982a);}for(var _0x1d6505=0x0;_0x1d6505<=_0x17c428;_0x1d6505+=_0x4e6f40){ctx_minimap_board[_0x58f7('0x51')](_0x41e47e,_0x1d6505+_0x2e982a);ctx_minimap_board[_0x58f7('0x52')](_0x549cfd+_0x41e47e,_0x1d6505+_0x2e982a);}ctx_minimap_board[_0x58f7('0x53')]='black';ctx_minimap_board['stroke']();}function drawCursor(){var _0x599a4a=x_window*0x1-minimap[_0x58f7('0x1b')]/zoomlevel/0x2;var _0x59ad92=x_window*0x1+minimap[_0x58f7('0x1b')]/zoomlevel/0x2;var _0x156489=y_window*0x1-minimap[_0x58f7('0x1f')]/zoomlevel/0x2;var _0x3d5726=y_window*0x1+minimap[_0x58f7('0x1f')]/zoomlevel/0x2;ctx_minimap_cursor[_0x58f7('0x4d')](0x0,0x0,minimap_cursor[_0x58f7('0x1b')],minimap_cursor['height']);if(x<_0x599a4a||x>_0x59ad92||y<_0x156489||y>_0x3d5726)return;xoff_c=x-_0x599a4a;yoff_c=y-_0x156489;ctx_minimap_cursor[_0x58f7('0x50')]();ctx_minimap_cursor[_0x58f7('0x54')]=zoomlevel/0x3;ctx_minimap_cursor[_0x58f7('0x53')]=_0x58f7('0x55');ctx_minimap_cursor['rect'](zoomlevel*xoff_c,zoomlevel*yoff_c,zoomlevel,zoomlevel);ctx_minimap_cursor[_0x58f7('0x56')]();}function getCenter(){var _0x3101d0=window['location'][_0x58f7('0x57')];x_window=_0x3101d0[_0x58f7('0x58')](re,'$2');y_window=_0x3101d0['replace'](re,'$3');if(x_window==_0x3101d0||y_window==_0x3101d0){x_window=0x0;y_window=0x0;}loadTemplates();}function findCoor(){var _0x36be83=document['querySelectorAll'](_0x58f7('0x59'));coorDOM=document[_0x58f7('0xb')](_0x58f7('0x5a'));}
